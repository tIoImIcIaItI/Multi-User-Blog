{% extends "base.html" %}

{% block content %}

    <a href="/">all posts</a><br>

    <h2 data-id="{{entry.key.urlsafe()}}">{{ entry.subject }}</h2>

    {{ entry.key.parent().id() }}
    {{ entry.modified }}

    <p>{{ entry.content_as_html()|safe }}</p>

    {% if can.edit %}
    <a href="/posts/{{entry.key.urlsafe()}}/edit">edit</a>
    {% endif %}

    {% if can.delete %}
    <form action="/posts/{{entry.key.urlsafe()}}/delete" method="POST">
        <input type="hidden" name="id" value="{{entry.key.urlsafe()}}" />
        <button type="submit">delete</button>
    </form>
    {% endif %}

    <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
    {{ entry.upvotes or 0}}
    {% if can.vote %}
    <form action="/posts/{{entry.key.urlsafe()}}/upvote" method="POST">
        <input type="hidden" name="id" value="{{entry.key.urlsafe()}}" />
        <button type="submit">upvote</button>
    </form>
    {% endif %}

    <i class="fa fa-thumbs-o-down" aria-hidden="true"></i>
    {{ entry.downvotes or 0}}
    {% if can.vote %}
    <form action="/posts/{{entry.key.urlsafe()}}/downvote" method="POST">
        <input type="hidden" name="id" value="{{entry.key.urlsafe()}}" />
        <button type="submit">downvote</button>
    </form>
    {% endif %}

    {% if can.comment %}
    <h3>Add Comment</h3>
    <form action="/posts/{{entry.key.urlsafe()}}/comment" method="POST">
        <input type="hidden" name="id" value="{{entry.key.urlsafe()}}" />
        <div>
            <label for="content">Content</label>
            <textarea id="content" name="content">{{content or ''}}</textarea>
            <div>{{content_error or ''}}</div>
        </div>
        <button type="submit">Submit</button>
    </form>
    {% endif %}

    <ul>
        {% for comment in comments %}
        <li data-id="{{comment.key.urlsafe()}}">
            {{comment.modified}}
            {{comment.username}}
            <p>{{comment.content}}</p>

            {% if comment.can.edit %}
            <a href="/comments/{{comment.key.urlsafe()}}/edit">edit</a>
            {% endif %}

            {% if comment.can.delete %}
            <form action="/comments/{{comment.key.urlsafe()}}/delete" method="POST">
                <input type="hidden" name="id" value="{{comment.key.urlsafe()}}" />
                <button type="submit">delete</button>
            </form>
            {% endif %}

        </li>
        {% endfor %}
    </ul>

{% endblock %}
